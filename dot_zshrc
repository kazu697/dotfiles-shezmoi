bindkey -e
eval "$(mise activate zsh)"
eval "$(sheldon source)"

# Load custom functions from rc directory
for rc_file in ${XDG_CONFIG_HOME:-$HOME/.config}/zsh/rc/*.zsh(N); do
    source "$rc_file"
done
# eval "$(gtr completion zsh)"
# The following lines have been added by Docker Desktop to enable Docker CLI completions.
fpath=(${HOME}/.docker/completions ${HOME}/.zsh/completions $fpath)
autoload -Uz compinit && compinit

alias d="docker"
alias dc="docker compose"
alias g="git"
alias gs="git switch"
alias gsc="git switch -c"
alias gpl="git pull"
alias gph="git push"
alias gphf="git push --force-with-lease"
alias tf="terraform"
alias gwa="git worktree add"
alias ll="ls -la"
alias lg="lazygit"
alias v="nvim"
alias ch="chezmoi"
alias vf="nvim \$(fzf)"

autoload -U +X bashcompinit && bashcompinit
complete -o nospace -C /opt/homebrew/Cellar/tfenv/3.0.0/versions/1.12.2/terraform terraform

# Enable substitution in the prompt.
setopt prompt_subst

alias c="claude"
alias gbd="git branch -D"
alias cdr="cd \$(ghq root)/\$(ghq list | fzf)"
alias vim="nvim"
eval "$(starship init zsh)"
source <(fzf --zsh)

function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	command yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

# ghq
function ghq-fzf() {
  local src=$(ghq list | fzf --preview "bat --color=always --style=header,grid --line-range :80 $(ghq root)/{}/README.*")
  if [ -n "$src" ]; then
    BUFFER="cd $(ghq root)/$src"
    zle accept-line
  fi
  zle -R -c
}
zle -N ghq-fzf

bindkey '^g' ghq-fzf

# gtr worktree branch selector with fzf
function gw-fzf() {
  local selected=$(gtr list --porcelain | rg -v '\(detached\)' | awk '{print $2}' | fzf --prompt="worktree> ")
  if [ -n "$selected" ]; then
    cd "$(git gtr go "$selected")"
  fi
  zle reset-prompt
}
zle -N gw-fzf
bindkey '^W' gw-fzf

setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
